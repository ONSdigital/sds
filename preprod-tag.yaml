---
steps:
- name: 'gcr.io/cloud-builders/git'
  args: ['rev-parse', '--short', 'HEAD']
  id: 'get_short_sha'
  env:
  - 'SHORT_SHA=/workspace/short_sha'
- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'bash'
  args:
  - '-c'
  - |
    docker pull europe-west2-docker.pkg.dev/ons-sds-dev/sds/sds:$(cat /workspace/short_sha)
    docker tag europe-west2-docker.pkg.dev/ons-sds-dev/sds/sds:$(cat /workspace/short_sha) europe-west2-docker.pkg.dev/ons-sds-preprod/sds/sds:$TAG_NAME
    docker push europe-west2-docker.pkg.dev/ons-sds-preprod/sds/sds:$TAG_NAME
images:
- 'europe-west2-docker.pkg.dev/ons-sds-preprod/sds/sds:$TAG_NAME'
options:
  logging: CLOUD_LOGGING_ONLY
